<html xmlns="http://www.w3.org/1999/html">
<head>
    <link href="stylesheets/bootstrap.min.css" rel="stylesheet" media="screen">
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script src="javascripts/bootstrap.min.js"></script>
    <script src="javascripts/spin.min.js"></script>
    <style>
        body { width: 250px; margin: 0 auto; text-align: center;}
        input { padding: 14px 6px; }
    </style>
</head>
<body>

<script type="text/javascript">
    function start(theme, platform) {
        $.get($('#baseUrl').val() + '/init/' + theme, function(data) {
            generate(data.key, platform);
        });
    }

    function generate(key, platform) {
        var url = $('#baseUrl').val() + '/generate/' + platform;
        $.post(
            url,
            {
                key: key,
                assetsClassName: $('#assetsClassName').val(),
                androidPackage: $('#androidPackage').val(),
                publicKey: "MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAndHbBVrbynZ9LOQhRCA/+dzYyQeT7qcbo6BD16O+7ltau6JLy78emOo4615+N3dl5RJ3FBlRw14aS+KhNAf0gMlrk3RBQA5d+sY/8oD22kC8Gn7blwsmk3LWYqOiGGXFtRxUyBxdibjFo0+qBz+BXJzfKYV+Y3wSDz0RBUoY9+akbF3EHuB6d02fXLeeIAswB28OlAM4PUuHSbj9lDNFefJwawQ7kgUALETJ98ImKlPUzG0jVh1t9vUOarsIZdzWmVu69+Au3mniqzcGY9gZyfYf0n7cNR3isSDfNOjeisDpfNpY/ljf71/6ns3/WjDwtXB2eDal5fz7fbsLEWRkSwIDAQAB",
                theme: $('#themeName').val(),
                exampleProjectName: $('#exampleProjName').val(),
                example: $('#exampleProj').val(),
                model: JSON.parse($('#modelJson').val())

            },
                function(body){
                    console.log("got " + body.url);
                    $('#fetch_button').attr('href', body.url);
                    $('#spinner').hide();
                    $('#fetch_button').show();
                    $('#gen_button').button('reset');

        //            if (body && body.url) {
        //                document.location = body.url;
        //            }
        //    fs.writeFileSync('file.zip', body, 'binary');
                });
    }
    $(function() {

        var opts = {
            lines: 13, // The number of lines to draw
            length: 5, // The length of each line
            width: 4, // The line thickness
            radius: 7, // The radius of the inner circle
            corners: 1, // Corner roundness (0..1)
            rotate: 0, // The rotation offset
            color: '#000', // #rgb or #rrggbb
            speed: 1, // Rounds per second
            trail: 60, // Afterglow percentage
            shadow: false, // Whether to render a shadow
            hwaccel: false, // Whether to use hardware acceleration
            className: 'spinner', // The CSS class to assign to the spinner
            zIndex: 2e9, // The z-index (defaults to 2000000000)
            top: 'auto', // Top position relative to parent in px
            left: 'auto' // Left position relative to parent in px
        };
        var targetSpinner = $('#spinner');
        var spinner = new Spinner(opts).spin(targetSpinner[0]);
        targetSpinner.hide();

        $('#gen_button').click(function () {
            var btn = $(this);
            btn.button('loading');
            targetSpinner.show();
            start('muffinRush', 'android');
        });

    });


</script>

<br/>
<br/>

<section>

    <fieldset>
        <legend>Demo Code Generator</legend>
        <input id="baseUrl" type="text" placeholder="Base Url ..." value="http://refaelos.dyndns.tv:3001">
        <input id="assetsClassName" type="text" placeholder="Assets Class Name …" value="MuffinRushAssets">
        <input id="androidPackage" type="text" placeholder="Android package …" value="com.soomla.example.muffinRush">
        <input id="publicKey" type="text" placeholder="Publick key (default)…" disabled>
        <input id="themeName" type="text" placeholder="Theme name …" value="muffinRush">
        <input id="exampleProj" type="text" placeholder="Example project/usage/none …" value="project">
        <input id="exampleProjName" type="text" placeholder="Example project name …" value="TestExample">
        <textarea placeholder="Model JSON ..." rows="10" id="modelJson" >
            { "categories" : [ { "id" : 1,
            "name" : "General"
            } ],
            "cssFiles" : [ "../thememuffinRush/theme/less/muffinRush.less" ],
            "currencyPacks" : [ { "amount" : 10,
            "categoryId" : 1,
            "currency_itemId" : "currency_muffin",
            "itemId" : "muffins_10",
            "name" : "10 Muffins",
            "price" : 0.98999999999999999,
            "productId" : "muffins_10"
            },
            { "amount" : 50,
            "categoryId" : 1,
            "currency_itemId" : "currency_muffin",
            "itemId" : "muffins_50",
            "name" : "50 Muffins",
            "price" : 1.99,
            "productId" : "android.test.purchased"
            },
            { "amount" : 400,
            "categoryId" : 1,
            "currency_itemId" : "currency_muffin",
            "itemId" : "muffins_400",
            "name" : "400 Muffins",
            "price" : 4.9900000000000002,
            "productId" : "muffins_400"
            },
            { "amount" : 1000,
            "categoryId" : 1,
            "currency_itemId" : "currency_muffin",
            "itemId" : "muffins_1000",
            "name" : "1000 Muffins",
            "price" : 8.9900000000000002,
            "productId" : "muffins_1000"
            }
            ],
            "jsFiles" : [ "../theme/js/muffinRushViews.js" ],
            "modelAssets" : { "categories" : {  },
            "currencyPacks" : { "muffins_10" : "../theme/img/currencyPacks/muffins01.png",
            "muffins_1000" : "../theme/img/currencyPacks/muffins04.png",
            "muffins_400" : "../theme/img/currencyPacks/muffins03.png",
            "muffins_50" : "../theme/img/currencyPacks/muffins02.png"
            },
            "virtualCurrencies" : { "currency_muffin" : "../theme/img/muffin.png" },
            "virtualGoods" : { "chocolate_cake" : "../theme/img/items/chocolate_cake.png",
            "cream_cup" : "../theme/img/items/cream_cup.png",
            "fruit_cake" : "../theme/img/items/fruit_cake.png",
            "pavlova" : "../theme/img/items/pavlova.png"
            }
            },
            "templatePath" : "../theme/templates",
            "theme" : { "isOrientationLandscape" : false,
            "name" : "muffinRush",
            "pages" : { "currencyPacks" : { "backButton" : "../theme/img/back.png",
            "background" : "../theme/img/Bg_Wall.png",
            "balance" : "../theme/img/YourMuf.png",
            "headerBackground" : "../theme/img/Roof-Extended.png",
            "list" : { "background" : "../theme/img/InnerBG.png" },
            "listItem" : { "background" : "../theme/img/Bar.png",
            "itemBackground" : "../theme/img/Mapit.png"
            },
            "title" : "../theme/img/Store_Store.png"
            },
            "goods" : { "backButton" : "../theme/img/back.png",
            "background" : "../theme/img/Bg_Wall.png",
            "balance" : "../theme/img/YourMuf.png",
            "headerBackground" : "../theme/img/Roof-Extended.png",
            "list" : { "background" : "../theme/img/InnerBG.png" },
            "listItem" : { "background" : "../theme/img/Bar.png",
            "itemBackground" : "../theme/img/Mapit.png"
            },
            "moreCurrencyButton" : "../theme/img/GetMore.png",
            "noFundsModal" : { "background" : "img.png",
            "description" : "../theme/img/modalDialog/Description.png",
            "noButton" : "../theme/img/modalDialog/No.png",
            "yesButton" : "../theme/img/modalDialog/Yes.png"
            },
            "title" : "../theme/img/Store_Store.png"
            }
            },
            "template" : "muffinRush",
            "version" : 1
            },
            "virtualCurrencies" : [ { "description" : "",
            "itemId" : "currency_muffin",
            "name" : "Muffins"
            } ],
            "virtualGoods" : [ { "categoryId" : 1,
            "description" : "Customers buy a double portion on each purchase of this cake",
            "itemId" : "fruit_cake",
            "name" : "Fruit Cake",
            "priceModel" : { "type" : "static",
            "values" : { "currency_muffin" : 225 }
            }
            },
            { "categoryId" : 1,
            "description" : "Gives customers a sugar rush and they call their friends",
            "itemId" : "pavlova",
            "name" : "Pavlova",
            "priceModel" : { "type" : "static",
            "values" : { "currency_muffin" : 175 }
            }
            },
            { "categoryId" : 1,
            "description" : "A classic cake to maximize customer satisfaction",
            "itemId" : "chocolate_cake",
            "name" : "Choco-Cake",
            "priceModel" : { "type" : "static",
            "values" : { "currency_muffin" : 250 }
            }
            },
            { "categoryId" : 1,
            "description" : "Increase bakery reputation with this original pastry",
            "itemId" : "cream_cup",
            "name" : "Cream Cup",
            "priceModel" : { "type" : "static",
            "values" : { "currency_muffin" : 50 }
            }
            }
            ]
            }
        </textarea>
        <span class="help-block">this example will generate Android muffinRush theme</span>
    </fieldset>

</section>

<div><button type="button" id="gen_button" class="btn btn-primary btn-large btn-striped" data-loading-text="Generating your store ...    ">
    <i class="icon-plane icon-white"></i>
    Generate
</button></div>

<div style="margin-top: 50px;" id="spinner"></div>
<!--<button class="btn btn-primary" onclick="start('muffinRush', 'android'); return false;">generate</button>-->

<div style="margin-top: 30px;"><a href="#" onclick="$(this).hide();" style="display: none;" id="fetch_button" class="btn btn-primary btn-large btn-striped" data-loading-text="Generating your store ...    ">
    <i class="icon-arrow-down icon-white"></i>
    Download zip
</a></div>


</body>
</html>